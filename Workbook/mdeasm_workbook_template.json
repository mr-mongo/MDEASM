{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "EASM Workbook",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "workbook",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "logAnalyticsWorkspace": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "The name of the Log Analytics workspace to which this workbook will be associated"
      }
    },
    "logAnalyticsResourceGroup": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "The Resource Group of the Log Analytics workspace to which this workbook will be associated"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
  "variables": {
    "workbookSourceId": "[resourceId(parameters('logAnalyticsResourceGroup'), 'microsoft.operationalinsights/workspaces', parameters('logAnalyticsWorkspace'))]"
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2021-03-08",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"63f093d6-7fff-49c7-be5c-b5ae4ab28bb0\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_workbook_source\",\"label\":\"Workbook Data Source\",\"type\":10,\"description\":\"Select the data source for this workbook\",\"isRequired\":true,\"isGlobal\":true,\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\\"Log Analytics\\\",\\\"Azure Data Explorer\\\"]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"Azure Data Explorer\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"20\",\"name\":\"WorkbookSources\",\"styleSettings\":{\"margin\":\"10px\",\"padding\":\"10px\"}},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"64eb843a-d545-440c-9776-b61f3b9c7225\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_adx_cluster_uri\",\"label\":\"ADX Cluster URI\",\"type\":1,\"isRequired\":true,\"isGlobal\":true,\"timeContext\":{\"durationMs\":86400000},\"value\":\"https://fdpoeasmadx.eastus.kusto.windows.net\"},{\"id\":\"5b5b5fa5-5a5a-45ba-9374-5b35193c4192\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_adx_database_name\",\"label\":\"ADX Database Name\",\"type\":1,\"isRequired\":true,\"isGlobal\":true,\"timeContext\":{\"durationMs\":86400000},\"value\":\"FDPO_EASM_ADX\"},{\"id\":\"6736f8d1-7ac2-42db-91ea-31e78d435b93\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_workspace_name\",\"label\":\"EASM Workspace Name\",\"type\":2,\"isRequired\":true,\"isGlobal\":true,\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"EasmAsset\\\\r\\\\n|summarize by WorkspaceName\\\\r\\\\n|order by WorkspaceName asc\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":9,\"value\":\"KPMGIntl\"},{\"id\":\"b5b5729c-1a7b-4465-8673-cdfcc6073731\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_lastseen\",\"label\":\"Last Seen Within\",\"type\":4,\"isRequired\":true,\"isGlobal\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":2592000000}}],\"style\":\"above\",\"doNotRunWhenHidden\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"_workbook_source\",\"comparison\":\"isEqualTo\",\"value\":\"Azure Data Explorer\"},\"name\":\"ADXClusterParameters\",\"styleSettings\":{\"margin\":\"10px\",\"padding\":\"10px\"}},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"f7c71b4f-116f-4866-bab5-a82909d0fc46\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_la_workspace\",\"label\":\"Log Analytics Workspace\",\"type\":5,\"isRequired\":true,\"isGlobal\":true,\"typeSettings\":{\"resourceTypeFilter\":{\"microsoft.operationalinsights/workspaces\":true},\"additionalResourceOptions\":[]},\"timeContext\":{\"durationMs\":86400000},\"value\":\"[variables('workbookSourceId')]\"},{\"id\":\"f7320109-da82-4eca-9f94-c6256c8a405f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_workspace_name\",\"label\":\"EASM Workspace Name\",\"type\":2,\"isRequired\":true,\"isGlobal\":true,\"query\":\"EasmAsset\\r\\n|summarize by WorkspaceName\\r\\n|order by WorkspaceName asc\",\"crossComponentResources\":[\"{_la_workspace}\"],\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"95d506d7-3730-4a94-813a-e9065a6ca448\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_lastseen\",\"label\":\"Last Seen Within\",\"type\":4,\"isRequired\":true,\"isGlobal\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":2419200000}}],\"style\":\"above\",\"doNotRunWhenHidden\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"74\",\"conditionalVisibility\":{\"parameterName\":\"_workbook_source\",\"comparison\":\"isEqualTo\",\"value\":\"Log Analytics\"},\"name\":\"LAWorkspaceParameters\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"nav\",\"links\":[{\"id\":\"f598ddc1-769b-425f-930b-0212df462ed3\",\"cellValue\":\"ADX Workspace Summary\",\"linkTarget\":\"step\",\"linkLabel\":\"Summary\",\"preText\":\"Navigation Menu ||\",\"style\":\"primary\"},{\"id\":\"490c6ce3-b954-4eba-b8c8-20240915a19e\",\"cellValue\":\"ADX Risk Findings\",\"linkTarget\":\"step\",\"linkLabel\":\"Risk Findings\",\"preText\":\"\",\"style\":\"primary\"},{\"id\":\"317316dc-258d-4f51-90b3-0a6b4fed3908\",\"cellValue\":\"ADX CVEs\",\"linkTarget\":\"step\",\"linkLabel\":\"CVEs\",\"preText\":\"\",\"style\":\"primary\"},{\"id\":\"168fd11c-6ec6-4e47-a632-e16cb4958ec8\",\"cellValue\":\"ADX Host Details\",\"linkTarget\":\"step\",\"linkLabel\":\"Hosts\",\"style\":\"primary\"},{\"id\":\"1ce7279b-8e43-43aa-b82a-e9363e8cae3e\",\"cellValue\":\"ADX IP Addres Details\",\"linkTarget\":\"step\",\"linkLabel\":\"IPs\",\"style\":\"primary\"},{\"id\":\"13ec12b7-d2b1-4f61-801e-c73076a19226\",\"cellValue\":\"ADX Page Details\",\"linkTarget\":\"step\",\"linkLabel\":\"Pages\",\"style\":\"primary\"},{\"id\":\"40c2b047-ec0a-4e29-9ed2-6f4a77484d44\",\"cellValue\":\"ADX SSL Certificate Details\",\"linkTarget\":\"step\",\"linkLabel\":\"Certificates\",\"style\":\"primary\"},{\"id\":\"af18dea8-4dbb-46a7-b472-3ccb71412493\",\"cellValue\":\"ADX Domain Details\",\"linkTarget\":\"step\",\"linkLabel\":\"Domains\",\"style\":\"primary\"}]},\"conditionalVisibility\":{\"parameterName\":\"_workbook_source\",\"comparison\":\"isEqualTo\",\"value\":\"Azure Data Explorer\"},\"name\":\"ADX Navigation Menu\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"nav\",\"links\":[{\"id\":\"63020326-d7fa-4835-943f-13f67a63eaf1\",\"cellValue\":\"LA Workspace Summary\",\"linkTarget\":\"step\",\"linkLabel\":\"Summary\",\"preText\":\"Navigation Menu  |\",\"style\":\"primary\"},{\"id\":\"de135273-c57e-414f-b35b-8f447ccf3f15\",\"cellValue\":\"LA Risk Findings\",\"linkTarget\":\"step\",\"linkLabel\":\"Risk Findings\",\"preText\":\"\",\"style\":\"primary\"},{\"id\":\"30bd0ef2-4cd0-455b-98d9-cc9b99745b87\",\"cellValue\":\"LA CVEs\",\"linkTarget\":\"step\",\"linkLabel\":\"CVEs\",\"preText\":\"\",\"style\":\"primary\"}]},\"conditionalVisibility\":{\"parameterName\":\"_workbook_source\",\"comparison\":\"isEqualTo\",\"value\":\"Log Analytics\"},\"name\":\"LA Navigation Menu\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Workspace Summary\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(SnapshotDateTime, *) by AssetType,AssetUuid\\\\r\\\\n|summarize Count=count() by AssetType\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":4,\"showAnalytics\":true,\"title\":\"Asset Types\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"AssetType\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":true,\"sortOrderField\":2,\"size\":\"auto\"}},\"customWidth\":\"83\",\"name\":\"ADX Asset Types\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(SnapshotDateTime, *) by AssetType,AssetUuid\\\\r\\\\n|extend TotalCount = 'Total Assets'\\\\r\\\\n|summarize Total=count() by TotalCount\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":4,\"showAnalytics\":true,\"title\":\"Asset Count\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"TotalCount\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Total\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":true,\"sortOrderField\":2,\"size\":\"auto\"}},\"customWidth\":\"17\",\"name\":\"ADX Asset Count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|summarize Count=count() by AssetType,SnapshotDateTime\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"aggregation\":5,\"showAnnotations\":true,\"showAnalytics\":true,\"title\":\"Asset Types Over Time\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"timechart\",\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"AssetType\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"ADX Asset Types Over Time\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"92020e51-938f-4494-91af-80caea4acaff\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_port_summary\",\"label\":\"Ports Summary\",\"type\":10,\"typeSettings\":{\"additionalResourceOptions\":[]},\"jsonData\":\"[\\\"By System\\\",\\\"By Port\\\"]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"By Port\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"ADX Port Summary\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nunion isfuzzy=true (\\\\r\\\\n    EasmHostAsset\\\\r\\\\n\\\\t|where WorkspaceName == workspace\\\\r\\\\n    |where AssetLastSeen {_lastseen:query}\\\\r\\\\n    |where array_length(Ports) > 0\\\\r\\\\n    |extend System = Host\\\\r\\\\n    |extend Source = 'EasmHostAsset'\\\\r\\\\n    |mv-expand Ports\\\\r\\\\n    |extend Port = toint(Ports.Port)\\\\r\\\\n    |extend LastPortState = tostring(Ports.LastPortState)\\\\r\\\\n    |extend PortLastSeen = todatetime(Ports.PortStateLastSeen)\\\\r\\\\n    |where PortLastSeen > ago(30d)\\\\r\\\\n    |project System, Port, LastPortState, Source,PortLastSeen\\\\r\\\\n    ),\\\\r\\\\n    (\\\\r\\\\n    EasmIpAddressAsset\\\\r\\\\n\\\\t|where WorkspaceName == workspace\\\\r\\\\n    |where AssetLastSeen > ago(30d)\\\\r\\\\n    |where array_length(Ports) > 0\\\\r\\\\n    |extend System = IpAddress\\\\r\\\\n    |extend Source = 'EasmIpAddressAsset'\\\\r\\\\n    |mv-expand Ports\\\\r\\\\n    |extend Port = toint(Ports.Port)\\\\r\\\\n    |extend LastPortState = tostring(Ports.LastPortState)\\\\r\\\\n    |extend PortLastSeen = todatetime(Ports.PortStateLastSeen)\\\\r\\\\n    |where PortLastSeen > ago(30d)\\\\r\\\\n    |project System, Port, LastPortState, Source,PortLastSeen\\\\r\\\\n    )\\\\r\\\\n|project System, Port, LastPortState, Source, PortLastSeen\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(PortLastSeen,*) by System, Port, LastPortState, Source\\\\r\\\\n|sort by System\\\\r\\\\n//|summarize AllPorts = make_set(Port) by System\\\\r\\\\n//|summarize AllSystems = make_set(System) by Port\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":0,\"showAnalytics\":true,\"title\":\"All Ports\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"table\",\"gridSettings\":{\"rowLimit\":5000,\"filter\":true},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"System\"},\"leftContent\":{\"columnMatch\":\"AllPorts\"},\"showBorder\":false},\"graphSettings\":{\"type\":0}},\"customWidth\":\"60\",\"conditionalVisibilities\":[{\"parameterName\":\"_port_summary\",\"comparison\":\"isNotEqualTo\",\"value\":\"By System\"},{\"parameterName\":\"_port_summary\",\"comparison\":\"isNotEqualTo\",\"value\":\"By Port\"}],\"name\":\"ADX All Ports_no groupBy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nunion isfuzzy=true (\\\\r\\\\n    EasmHostAsset\\\\r\\\\n\\\\t|where WorkspaceName == workspace\\\\r\\\\n    |where AssetLastSeen {_lastseen:query}\\\\r\\\\n    |where array_length(Ports) > 0\\\\r\\\\n    |extend System = Host\\\\r\\\\n    |extend Source = 'EasmHostAsset'\\\\r\\\\n    |mv-expand Ports\\\\r\\\\n    |extend Port = toint(Ports.Port)\\\\r\\\\n    |extend LastPortState = tostring(Ports.LastPortState)\\\\r\\\\n    |extend PortLastSeen = todatetime(Ports.PortStateLastSeen)\\\\r\\\\n    |where PortLastSeen > ago(30d)\\\\r\\\\n    |project System, Port, LastPortState, Source,PortLastSeen\\\\r\\\\n    ),\\\\r\\\\n    (\\\\r\\\\n    EasmIpAddressAsset\\\\r\\\\n\\\\t|where WorkspaceName == workspace\\\\r\\\\n    |where AssetLastSeen > ago(30d)\\\\r\\\\n    |where array_length(Ports) > 0\\\\r\\\\n    |extend System = IpAddress\\\\r\\\\n    |extend Source = 'EasmIpAddressAsset'\\\\r\\\\n    |mv-expand Ports\\\\r\\\\n    |extend Port = toint(Ports.Port)\\\\r\\\\n    |extend LastPortState = tostring(Ports.LastPortState)\\\\r\\\\n    |extend PortLastSeen = todatetime(Ports.PortStateLastSeen)\\\\r\\\\n    |where PortLastSeen > ago(30d)\\\\r\\\\n    |project System, Port, LastPortState, Source,PortLastSeen\\\\r\\\\n    )\\\\r\\\\n|project System, Port, LastPortState, Source, PortLastSeen\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(PortLastSeen,*) by System, Port, LastPortState, Source\\\\r\\\\n|summarize AllPorts = make_set(Port) by System\\\\r\\\\n//|summarize AllSystems = make_set(System) by Port\\\\r\\\\n|sort by System\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":0,\"showAnalytics\":true,\"title\":\"All Ports\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"table\",\"gridSettings\":{\"rowLimit\":1000,\"filter\":true,\"sortBy\":[{\"itemKey\":\"System\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"System\",\"sortOrder\":1}],\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"System\"},\"leftContent\":{\"columnMatch\":\"AllPorts\"},\"showBorder\":false},\"graphSettings\":{\"type\":0}},\"customWidth\":\"60\",\"conditionalVisibility\":{\"parameterName\":\"_port_summary\",\"comparison\":\"isEqualTo\",\"value\":\"By System\"},\"name\":\"ADX All Ports_groupBy System\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nunion isfuzzy=true (\\\\r\\\\n    EasmHostAsset\\\\r\\\\n\\\\t|where WorkspaceName == workspace\\\\r\\\\n    |where AssetLastSeen {_lastseen:query}\\\\r\\\\n    |where array_length(Ports) > 0\\\\r\\\\n    |extend System = Host\\\\r\\\\n    |extend Source = 'EasmHostAsset'\\\\r\\\\n    |mv-expand Ports\\\\r\\\\n    |extend Port = toint(Ports.Port)\\\\r\\\\n    |extend LastPortState = tostring(Ports.LastPortState)\\\\r\\\\n    |extend LastPortState = tostring(Ports.LastPortState)\\\\r\\\\n    |extend PortLastSeen = todatetime(Ports.PortStateLastSeen)\\\\r\\\\n    |where PortLastSeen > ago(30d)\\\\r\\\\n    |project System, Port, LastPortState, Source,PortLastSeen\\\\r\\\\n    ),\\\\r\\\\n    (\\\\r\\\\n    EasmIpAddressAsset\\\\r\\\\n\\\\t|where WorkspaceName == workspace\\\\r\\\\n    |where AssetLastSeen > ago(30d)\\\\r\\\\n    |where array_length(Ports) > 0\\\\r\\\\n    |extend System = IpAddress\\\\r\\\\n    |extend Source = 'EasmIpAddressAsset'\\\\r\\\\n    |mv-expand Ports\\\\r\\\\n    |extend Port = toint(Ports.Port)\\\\r\\\\n    |extend LastPortState = tostring(Ports.LastPortState)\\\\r\\\\n    |extend PortLastSeen = todatetime(Ports.PortStateLastSeen)\\\\r\\\\n    |where PortLastSeen > ago(30d)\\\\r\\\\n    |project System, Port, LastPortState, Source,PortLastSeen\\\\r\\\\n    )\\\\r\\\\n|project System, Port, LastPortState, Source, PortLastSeen\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(PortLastSeen,*) by System, Port, LastPortState, Source\\\\r\\\\n//|summarize AllPorts = make_set(Port) by System\\\\r\\\\n|summarize AllSystems = make_set(System) by Port\\\\r\\\\n|sort by Port asc\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":0,\"showAnalytics\":true,\"title\":\"All Ports\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"table\",\"gridSettings\":{\"rowLimit\":1000,\"filter\":true},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"System\"},\"leftContent\":{\"columnMatch\":\"AllPorts\"},\"showBorder\":false},\"graphSettings\":{\"type\":0}},\"customWidth\":\"60\",\"conditionalVisibility\":{\"parameterName\":\"_port_summary\",\"comparison\":\"isEqualTo\",\"value\":\"By Port\"},\"name\":\"ADX All Ports_groupBy Port\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmIpAddressAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|union kind=inner (EasmHostAsset | where WorkspaceName == workspace)\\\\r\\\\n|mv-expand Locations\\\\r\\\\n|extend Region = tostring(Locations.Region), City = tostring(Locations.City), Latitude = toreal(Locations.Latitude), Longitude = toreal(Locations.Longitude), LocationLastSeen = todatetime(Locations.LastSeen), LocationFirstSeen = todatetime(Locations.FirstSeen)\\\\r\\\\n|where isnotempty(Latitude) and isnotempty(Longitude) and isnotempty(Region) and isnotempty(City)\\\\r\\\\n|project-keep AssetName,Region,City,Latitude,Longitude,LocationFirstSeen,LocationLastSeen\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(LocationLastSeen, *) by AssetName,Region,City,Latitude,Longitude\\\\r\\\\n//|summarize Count=count() by Region,City\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":0,\"showAnalytics\":true,\"title\":\"Asset Locations\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"map\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Region\",\"formatter\":1},\"subtitleContent\":{\"columnMatch\":\"City\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"showBorder\":false,\"sortCriteriaField\":\"Count\",\"sortOrderField\":2,\"size\":\"auto\"},\"mapSettings\":{\"locInfo\":\"LatLong\",\"locInfoColumn\":\"Region\",\"latitude\":\"Latitude\",\"longitude\":\"Longitude\",\"sizeSettings\":\"Latitude\",\"sizeAggregation\":\"Count\",\"opacity\":0.9,\"labelSettings\":\"City\",\"legendMetric\":\"City\",\"numberOfMetrics\":20,\"legendAggregation\":\"Count\",\"itemColorSettings\":{\"nodeColorField\":\"Latitude\",\"colorAggregation\":\"Count\",\"type\":\"heatmap\",\"heatmapPalette\":\"categorical\",\"heatmapMin\":5}}},\"customWidth\":\"40\",\"name\":\"ADX Asset Locations\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"df71056a-a50d-423b-82ab-204948cebc96\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_wc_sort\",\"label\":\"Sort Web Component\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[]},\"jsonData\":\"[\\\"asc\\\",\\\"desc\\\"]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"desc\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmAssetWebComponent\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where AssetLastSeen {_lastseen:query} and WebComponentLastSeen {_lastseen:query}\\\\r\\\\n|extend Name = WebComponentName, Version = WebComponentVersion\\\\r\\\\n|project-keep Name,Version,SnapshotDateTime,AssetName\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(SnapshotDateTime, *) by Name,Version,AssetName\\\\r\\\\n|summarize Count=count() by Name,Version\\\\r\\\\n|sort by Count {_wc_sort}\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":0,\"showAnalytics\":true,\"title\":\"Web Components\",\"showRefreshButton\":true,\"exportParameterName\":\"_wc_detail\",\"exportDefaultValue\":\"{\\\"Name\\\":\\\"\\\",\\\"Version\\\":\\\"\\\",\\\"Category\\\":\\\"\\\"}\",\"showExportToExcel\":true,\"queryType\":9,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30ch\"}},{\"columnMatch\":\"Group\",\"formatter\":1,\"formatOptions\":{\"customColumnWidthSetting\":\"30ch\"}},{\"columnMatch\":\"Name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"25ch\"}},{\"columnMatch\":\"Version\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"12ch\"}},{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"11ch\"}},{\"columnMatch\":\"$gen_group\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30ch\"}}],\"rowLimit\":5000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Name\"],\"expandTopLevel\":true}}},\"customWidth\":\"40\",\"name\":\"ADX Web Components\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nlet Name = tostring(parse_json('{_wc_detail}').Name);\\\\r\\\\nlet Version = tostring(parse_json('{_wc_detail}').Version);\\\\r\\\\nEasmAssetWebComponent\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where AssetLastSeen {_lastseen:query} and WebComponentLastSeen {_lastseen:query}\\\\r\\\\n|where WebComponentName == Name and WebComponentVersion == Version\\\\r\\\\n|extend Category = WebComponentCategory\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(SnapshotDateTime, *) by AssetName,Name,Version\\\\r\\\\n|project-keep AssetName,Name,Version,Category,AssetLastSeen\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":0,\"showAnalytics\":true,\"title\":\"Investigate WebComponent\",\"noDataMessage\":\"Select a Web Component to find associated assets\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"gridSettings\":{\"rowLimit\":2000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"ADX WebComponent to Asset\",\"styleSettings\":{\"showBorder\":true}}]},\"conditionalVisibility\":{\"parameterName\":\"_workbook_source\",\"comparison\":\"isEqualTo\",\"value\":\"Azure Data Explorer\"},\"name\":\"ADX Workspace Summary\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Risk Findings\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\n//let lastseen = {_lastseen:query};\\\\r\\\\nEasmRisk\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where AssetLastSeen {_lastseen:query}\\\\r\\\\n|where CategoryName startswith_cs 'High'\\\\r\\\\n|extend Priority = 'High'\\\\r\\\\n|project-keep Priority,MetricDisplayName,SnapshotDateTime,AssetName\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(SnapshotDateTime, *) by Priority,MetricDisplayName,AssetName\\\\r\\\\n|summarize Count=count() by Priority,MetricDisplayName\\\\r\\\\n|order by Count desc \\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"showAnalytics\":true,\"title\":\"High Risk Findings\",\"showRefreshButton\":true,\"exportFieldName\":\"MetricDisplayName\",\"exportParameterName\":\"_risk_finding_high\",\"exportDefaultValue\":\"xyz\",\"showExportToExcel\":true,\"queryType\":9,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Priority\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"12ch\"}},{\"columnMatch\":\"MetricDisplayName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"55ch\"}},{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"12ch\"}}],\"filter\":true},\"sortBy\":[]},\"customWidth\":\"33\",\"name\":\"High Risk Findings\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\n//let lastseen = {_lastseen:query};\\\\r\\\\nEasmRisk\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where AssetLastSeen {_lastseen:query}\\\\r\\\\n|where CategoryName startswith_cs 'Medium'\\\\r\\\\n|extend Priority = 'Medium'\\\\r\\\\n|project-keep Priority,MetricDisplayName,SnapshotDateTime,AssetName\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(SnapshotDateTime, *) by Priority,MetricDisplayName,AssetName\\\\r\\\\n|summarize Count=count() by Priority,MetricDisplayName\\\\r\\\\n|sort by Count desc \\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"showAnalytics\":true,\"title\":\"Medium Risk Findings\",\"showRefreshButton\":true,\"exportFieldName\":\"MetricDisplayName\",\"exportParameterName\":\"_risk_finding_med\",\"exportDefaultValue\":\"xyz\",\"showExportToExcel\":true,\"queryType\":9,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Priority\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"12ch\"}},{\"columnMatch\":\"MetricDisplayName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"55ch\"}},{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"12ch\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"Count\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Count\",\"sortOrder\":2}]},\"customWidth\":\"33\",\"name\":\"Medium Risk Findings\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\n//let lastseen = {_lastseen:query};\\\\r\\\\nEasmRisk\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where AssetLastSeen {_lastseen:query}\\\\r\\\\n|where CategoryName startswith_cs 'Low'\\\\r\\\\n|extend Priority = 'Low'\\\\r\\\\n|project-keep Priority,MetricDisplayName,SnapshotDateTime,AssetName\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(SnapshotDateTime, *) by Priority,MetricDisplayName,AssetName\\\\r\\\\n|summarize Count=count() by Priority,MetricDisplayName\\\\r\\\\n|order by Count desc \\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"showAnalytics\":true,\"title\":\"Low Risk Findings\",\"showRefreshButton\":true,\"exportFieldName\":\"MetricDisplayName\",\"exportParameterName\":\"_risk_finding_low\",\"exportDefaultValue\":\"xyz\",\"showExportToExcel\":true,\"queryType\":9,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Priority\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"12ch\"}},{\"columnMatch\":\"MetricDisplayName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"55ch\"}},{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"12ch\"}}],\"filter\":true}},\"customWidth\":\"33\",\"name\":\"Low Risk Findings\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nlet metric_name_high = '{_risk_finding_high}';\\\\r\\\\nlet metric_name_med = '{_risk_finding_med}';\\\\r\\\\nlet metric_name_low = '{_risk_finding_low}';\\\\r\\\\nEasmRisk\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where AssetLastSeen {_lastseen:query}\\\\r\\\\n|where MetricDisplayName in (metric_name_high,metric_name_med,metric_name_low)\\\\r\\\\n|extend Priority =  case(CategoryName startswith_cs 'High','High',CategoryName startswith_cs 'Medium','Medium','Low')\\\\r\\\\n|project-keep AssetName,MetricDisplayName,AssetLastSeen,AssetDescription,Priority\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(AssetLastSeen, *) by AssetName,MetricDisplayName,AssetDescription,Priority\\\\r\\\\n|project-reorder Priority,AssetName\\\\r\\\\n|sort by Priority\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"showAnalytics\":true,\"title\":\"Risk Details\",\"noDataMessage\":\"No risk findings found. Select a risk finding above\",\"showRefreshButton\":true,\"exportParameterName\":\"_asset_name\",\"showExportToExcel\":true,\"queryType\":9,\"gridSettings\":{\"filter\":true}},\"name\":\"Risk Details\",\"styleSettings\":{\"showBorder\":true}}]},\"conditionalVisibility\":{\"parameterName\":\"_workbook_source\",\"comparison\":\"isEqualTo\",\"value\":\"Azure Data Explorer\"},\"name\":\"ADX Risk Findings\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"CVEs\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"37b59c82-360f-4114-a0e2-493af4089ff5\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_cvssscore\",\"label\":\"CVSS Score\",\"type\":2,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\\"1\\\",\\\"2\\\",\\\"3\\\",\\\"4\\\",\\\"5\\\",\\\"6\\\",\\\"7\\\",\\\"8\\\",\\\"9\\\",\\\"10\\\"]\",\"value\":\"10\"},{\"id\":\"e730581e-d227-4a03-a0b0-f6e4ca5dd945\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_cvss3score\",\"label\":\"CVSS 3 Score\",\"type\":2,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\\"1\\\",\\\"2\\\",\\\"3\\\",\\\"4\\\",\\\"5\\\",\\\"6\\\",\\\"7\\\",\\\"8\\\",\\\"9\\\",\\\"10\\\"]\",\"value\":\"10\"},{\"id\":\"6ce03701-994f-4699-8a0b-2121af3d303a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_group_by\",\"label\":\"Group By\",\"type\":10,\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\\"AssetName\\\",\\\"Cve\\\",\\\"WebComponent\\\"]\",\"value\":null}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"CVE Asset Score Filters\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\n//let lastseen = ago(totimespan(_lastseen));\\\\r\\\\nlet cvssscore = {_cvssscore};\\\\r\\\\nlet cvss3score = {_cvss3score};\\\\r\\\\nEasmAssetWebComponent\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where array_length(WebComponentCves) != 0\\\\r\\\\n|where WebComponentLastSeen {_lastseen:query}\\\\r\\\\n|mv-expand WebComponentCves\\\\r\\\\n|extend Cve = tostring(WebComponentCves.Cve), Cwe = tostring(WebComponentCves.Cwe), CvssScore = tolong(WebComponentCves.CvssScore), Cvss3Score = toreal(WebComponentCves.Cvss3Score)\\\\r\\\\n|where (CvssScore >= cvssscore or Cvss3Score >= cvss3score)\\\\r\\\\n|project-keep WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName,WebComponentLastSeen\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(WebComponentLastSeen, *) by WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName\\\\r\\\\n|project-reorder AssetName,WebComponentName,WebComponentVersion,Cve,CvssScore,Cvss3Score,Cwe\\\\r\\\\n|sort by WebComponentLastSeen desc\\\\r\\\\n//|summarize Asset = make_list(pack_all()) by AssetName\\\\r\\\\n//|summarize CVE = make_list(pack_all()) by Cve\\\\r\\\\n//|summarize WebComponent = make_list(pack_all()) by WebComponentName,WebComponentVersion\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":0,\"showAnalytics\":true,\"title\":\"Assets With CVEs\",\"showRefreshButton\":true,\"exportParameterName\":\"_asset_detail\",\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"table\",\"showExpandCollapseGrid\":true,\"gridSettings\":{\"rowLimit\":1000,\"filter\":true}},\"conditionalVisibilities\":[{\"parameterName\":\"_group_by\",\"comparison\":\"isNotEqualTo\",\"value\":\"Cve\"},{\"parameterName\":\"_group_by\",\"comparison\":\"isNotEqualTo\",\"value\":\"WebComponent\"},{\"parameterName\":\"_group_by\",\"comparison\":\"isNotEqualTo\",\"value\":\"AssetName\"}],\"name\":\"Assets With CVEs_no groupBy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\n//let lastseen = ago(totimespan(_lastseen));\\\\r\\\\nlet cvssscore = {_cvssscore};\\\\r\\\\nlet cvss3score = {_cvss3score};\\\\r\\\\nEasmAssetWebComponent\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where array_length(WebComponentCves) != 0\\\\r\\\\n|where WebComponentLastSeen {_lastseen:query}\\\\r\\\\n|mv-expand WebComponentCves\\\\r\\\\n|extend Cve = tostring(WebComponentCves.Cve), Cwe = tostring(WebComponentCves.Cwe), CvssScore = tolong(WebComponentCves.CvssScore), Cvss3Score = toreal(WebComponentCves.Cvss3Score)\\\\r\\\\n|where (CvssScore >= cvssscore or Cvss3Score >= cvss3score)\\\\r\\\\n|project-keep WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName,WebComponentLastSeen\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(WebComponentLastSeen, *) by WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName\\\\r\\\\n//|project-reorder AssetName,WebComponentName,WebComponentVersion,Cve,CvssScore,Cvss3Score,Cwe\\\\r\\\\n//|sort by WebComponentLastSeen desc\\\\r\\\\n|summarize Asset = make_list(pack_all()) by AssetName\\\\r\\\\n//|summarize CVE = make_list(pack_all()) by Cve\\\\r\\\\n//|summarize WebComponent = make_list(pack_all()) by WebComponentName,WebComponentVersion\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"showAnalytics\":true,\"title\":\"Assets With CVEs\",\"showRefreshButton\":true,\"exportParameterName\":\"_asset_detail\",\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"table\",\"showExpandCollapseGrid\":true,\"gridSettings\":{\"rowLimit\":1000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"_group_by\",\"comparison\":\"isEqualTo\",\"value\":\"AssetName\"},\"name\":\"Assets With CVEs_groupBy AssetName\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\n//let lastseen = ago(totimespan(_lastseen));\\\\r\\\\nlet cvssscore = {_cvssscore};\\\\r\\\\nlet cvss3score = {_cvss3score};\\\\r\\\\nEasmAssetWebComponent\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where array_length(WebComponentCves) != 0\\\\r\\\\n|where WebComponentLastSeen {_lastseen:query}\\\\r\\\\n|mv-expand WebComponentCves\\\\r\\\\n|extend Cve = tostring(WebComponentCves.Cve), Cwe = tostring(WebComponentCves.Cwe), CvssScore = tolong(WebComponentCves.CvssScore), Cvss3Score = toreal(WebComponentCves.Cvss3Score)\\\\r\\\\n|where (CvssScore >= cvssscore or Cvss3Score >= cvss3score)\\\\r\\\\n|project-keep WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName,WebComponentLastSeen\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(WebComponentLastSeen, *) by WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName\\\\r\\\\n//|project-reorder AssetName,WebComponentName,WebComponentVersion,Cve,CvssScore,Cvss3Score,Cwe\\\\r\\\\n//|sort by WebComponentLastSeen desc\\\\r\\\\n//|summarize Asset = make_list(pack_all()) by AssetName\\\\r\\\\n|summarize CVE = make_list(pack_all()) by Cve\\\\r\\\\n//|summarize WebComponent = make_list(pack_all()) by WebComponentName,WebComponentVersion\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"showAnalytics\":true,\"title\":\"Assets With CVEs\",\"showRefreshButton\":true,\"exportParameterName\":\"_asset_detail\",\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"table\",\"showExpandCollapseGrid\":true,\"gridSettings\":{\"rowLimit\":1000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"_group_by\",\"comparison\":\"isEqualTo\",\"value\":\"Cve\"},\"name\":\"Assets With CVEs_groupBy Cve\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\n//let lastseen = ago(totimespan(_lastseen));\\\\r\\\\nlet cvssscore = {_cvssscore};\\\\r\\\\nlet cvss3score = {_cvss3score};\\\\r\\\\nEasmAssetWebComponent\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where array_length(WebComponentCves) != 0\\\\r\\\\n|where WebComponentLastSeen {_lastseen:query}\\\\r\\\\n|mv-expand WebComponentCves\\\\r\\\\n|extend Cve = tostring(WebComponentCves.Cve), Cwe = tostring(WebComponentCves.Cwe), CvssScore = tolong(WebComponentCves.CvssScore), Cvss3Score = toreal(WebComponentCves.Cvss3Score)\\\\r\\\\n|where (CvssScore >= cvssscore or Cvss3Score >= cvss3score)\\\\r\\\\n|project-keep WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName,WebComponentLastSeen\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(WebComponentLastSeen, *) by WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName\\\\r\\\\n//|project-reorder AssetName,WebComponentName,WebComponentVersion,Cve,CvssScore,Cvss3Score,Cwe\\\\r\\\\n//|sort by WebComponentLastSeen desc\\\\r\\\\n//|summarize Asset = make_list(pack_all()) by AssetName\\\\r\\\\n//|summarize CVE = make_list(pack_all()) by Cve\\\\r\\\\n|summarize WebComponent = make_list(pack_all()) by WebComponentName,WebComponentVersion\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"showAnalytics\":true,\"title\":\"Assets With CVEs\",\"showRefreshButton\":true,\"exportParameterName\":\"_asset_detail\",\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"table\",\"showExpandCollapseGrid\":true,\"gridSettings\":{\"rowLimit\":1000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"_group_by\",\"comparison\":\"isEqualTo\",\"value\":\"WebComponent\"},\"name\":\"Assets With CVEs_groupBy WebComponentName\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\n//let lastseen = ago(totimespan(_lastseen));\\\\r\\\\nlet cvssscore = {_cvssscore};\\\\r\\\\nlet cvss3score = {_cvss3score};\\\\r\\\\nlet Cves = externaldata (CveId: string )\\\\r\\\\n[\\\\r\\\\n    h@'https://www.cisa.gov/sites/default/files/csv/known_exploited_vulnerabilities.csv'\\\\r\\\\n]\\\\r\\\\nwith (format='csv', ingestionMapping='[{\\\\\\\"Column\\\\\\\":\\\\\\\"CveId\\\\\\\",\\\\\\\"Properties\\\\\\\":{\\\\\\\"Ordinal\\\\\\\":\\\\\\\"0\\\\\\\"}}]')\\\\r\\\\n|where CveId != 'cveID';\\\\r\\\\nCves\\\\r\\\\n| join kind=rightsemi (EasmAssetWebComponent\\\\r\\\\n    |where WorkspaceName == workspace\\\\r\\\\n    |where array_length(WebComponentCves) != 0\\\\r\\\\n    |where WebComponentLastSeen {_lastseen:query}\\\\r\\\\n    |mv-expand WebComponentCves\\\\r\\\\n    |extend Cve = tostring(WebComponentCves.Cve), Cwe = tostring(WebComponentCves.Cwe), CvssScore = tolong(WebComponentCves.CvssScore), Cvss3Score = toreal(WebComponentCves.Cvss3Score)\\\\r\\\\n    |where (CvssScore >= cvssscore or Cvss3Score >= cvss3score) \\\\r\\\\n    |project-keep WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName,WebComponentLastSeen\\\\r\\\\n    |summarize hint.strategy=shuffle arg_max(WebComponentLastSeen, *) by WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName \\\\r\\\\n) on $left.CveId == $right.Cve\\\\r\\\\n|project-reorder AssetName,WebComponentName,WebComponentVersion,Cve,CvssScore,Cvss3Score,Cwe\\\\r\\\\n|sort by WebComponentLastSeen desc\\\\r\\\\n//|summarize Asset = make_list(pack_all()) by AssetName\\\\r\\\\n//|summarize CVE = make_list(pack_all()) by Cve\\\\r\\\\n//|summarize WebComponent = make_list(pack_all()) by WebComponentName,WebComponentVersion\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":0,\"showAnalytics\":true,\"title\":\"CISA Known Exploited Vulnerabilities\",\"showRefreshButton\":true,\"exportFieldName\":\"\",\"exportParameterName\":\"_asset_detail\",\"showExportToExcel\":true,\"queryType\":9,\"gridSettings\":{\"rowLimit\":1000,\"filter\":true}},\"conditionalVisibilities\":[{\"parameterName\":\"_group_by\",\"comparison\":\"isNotEqualTo\",\"value\":\"AssetName\"},{\"parameterName\":\"_group_by\",\"comparison\":\"isNotEqualTo\",\"value\":\"Cve\"},{\"parameterName\":\"_group_by\",\"comparison\":\"isNotEqualTo\",\"value\":\"WebComponent\"}],\"name\":\"CISA Known Exploited Vulnerabilities_no groupBy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\n//let lastseen = ago(totimespan(_lastseen));\\\\r\\\\nlet cvssscore = {_cvssscore};\\\\r\\\\nlet cvss3score = {_cvss3score};\\\\r\\\\nlet Cves = externaldata (CveId: string )\\\\r\\\\n[\\\\r\\\\n    h@'https://www.cisa.gov/sites/default/files/csv/known_exploited_vulnerabilities.csv'\\\\r\\\\n]\\\\r\\\\nwith (format='csv', ingestionMapping='[{\\\\\\\"Column\\\\\\\":\\\\\\\"CveId\\\\\\\",\\\\\\\"Properties\\\\\\\":{\\\\\\\"Ordinal\\\\\\\":\\\\\\\"0\\\\\\\"}}]')\\\\r\\\\n|where CveId != 'cveID';\\\\r\\\\nCves\\\\r\\\\n| join kind=rightsemi (EasmAssetWebComponent\\\\r\\\\n    |where WorkspaceName == workspace\\\\r\\\\n    |where array_length(WebComponentCves) != 0\\\\r\\\\n    |where WebComponentLastSeen {_lastseen:query}\\\\r\\\\n    |mv-expand WebComponentCves\\\\r\\\\n    |extend Cve = tostring(WebComponentCves.Cve), Cwe = tostring(WebComponentCves.Cwe), CvssScore = tolong(WebComponentCves.CvssScore), Cvss3Score = toreal(WebComponentCves.Cvss3Score)\\\\r\\\\n    |where (CvssScore >= cvssscore or Cvss3Score >= cvss3score) \\\\r\\\\n    |project-keep WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName,WebComponentLastSeen\\\\r\\\\n    |summarize hint.strategy=shuffle arg_max(WebComponentLastSeen, *) by WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName \\\\r\\\\n) on $left.CveId == $right.Cve\\\\r\\\\n//|project-reorder AssetName,WebComponentName,WebComponentVersion,Cve,CvssScore,Cvss3Score,Cwe\\\\r\\\\n//|sort by WebComponentLastSeen desc\\\\r\\\\n|summarize Asset = make_list(pack_all()) by AssetName\\\\r\\\\n//|summarize CVE = make_list(pack_all()) by Cve\\\\r\\\\n//|summarize WebComponent = make_list(pack_all()) by WebComponentName,WebComponentVersion\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"showAnalytics\":true,\"title\":\"CISA Known Exploited Vulnerabilities\",\"showRefreshButton\":true,\"exportFieldName\":\"\",\"exportParameterName\":\"_asset_detail\",\"showExportToExcel\":true,\"queryType\":9,\"gridSettings\":{\"rowLimit\":1000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"_group_by\",\"comparison\":\"isEqualTo\",\"value\":\"AssetName\"},\"name\":\"CISA Known Exploited Vulnerabilities_groupBy AssetName\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\n//let lastseen = ago(totimespan(_lastseen));\\\\r\\\\nlet cvssscore = {_cvssscore};\\\\r\\\\nlet cvss3score = {_cvss3score};\\\\r\\\\nlet Cves = externaldata (CveId: string )\\\\r\\\\n[\\\\r\\\\n    h@'https://www.cisa.gov/sites/default/files/csv/known_exploited_vulnerabilities.csv'\\\\r\\\\n]\\\\r\\\\nwith (format='csv', ingestionMapping='[{\\\\\\\"Column\\\\\\\":\\\\\\\"CveId\\\\\\\",\\\\\\\"Properties\\\\\\\":{\\\\\\\"Ordinal\\\\\\\":\\\\\\\"0\\\\\\\"}}]')\\\\r\\\\n|where CveId != 'cveID';\\\\r\\\\nCves\\\\r\\\\n| join kind=rightsemi (EasmAssetWebComponent\\\\r\\\\n    |where WorkspaceName == workspace\\\\r\\\\n    |where array_length(WebComponentCves) != 0\\\\r\\\\n    |where WebComponentLastSeen {_lastseen:query}\\\\r\\\\n    |mv-expand WebComponentCves\\\\r\\\\n    |extend Cve = tostring(WebComponentCves.Cve), Cwe = tostring(WebComponentCves.Cwe), CvssScore = tolong(WebComponentCves.CvssScore), Cvss3Score = toreal(WebComponentCves.Cvss3Score)\\\\r\\\\n    |where (CvssScore >= cvssscore or Cvss3Score >= cvss3score) \\\\r\\\\n    |project-keep WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName,WebComponentLastSeen\\\\r\\\\n    |summarize hint.strategy=shuffle arg_max(WebComponentLastSeen, *) by WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName \\\\r\\\\n) on $left.CveId == $right.Cve\\\\r\\\\n//|project-reorder AssetName,WebComponentName,WebComponentVersion,Cve,CvssScore,Cvss3Score,Cwe\\\\r\\\\n//|sort by WebComponentLastSeen desc\\\\r\\\\n//|summarize Asset = make_list(pack_all()) by AssetName\\\\r\\\\n|summarize CVE = make_list(pack_all()) by Cve\\\\r\\\\n//|summarize WebComponent = make_list(pack_all()) by WebComponentName,WebComponentVersion\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"showAnalytics\":true,\"title\":\"CISA Known Exploited Vulnerabilities\",\"showRefreshButton\":true,\"exportFieldName\":\"\",\"exportParameterName\":\"_asset_detail\",\"showExportToExcel\":true,\"queryType\":9,\"gridSettings\":{\"rowLimit\":1000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"_group_by\",\"comparison\":\"isEqualTo\",\"value\":\"Cve\"},\"name\":\"CISA Known Exploited Vulnerabilities_groupBy Cve\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\n//let lastseen = ago(totimespan(_lastseen));\\\\r\\\\nlet cvssscore = {_cvssscore};\\\\r\\\\nlet cvss3score = {_cvss3score};\\\\r\\\\nlet Cves = externaldata (CveId: string )\\\\r\\\\n[\\\\r\\\\n    h@'https://www.cisa.gov/sites/default/files/csv/known_exploited_vulnerabilities.csv'\\\\r\\\\n]\\\\r\\\\nwith (format='csv', ingestionMapping='[{\\\\\\\"Column\\\\\\\":\\\\\\\"CveId\\\\\\\",\\\\\\\"Properties\\\\\\\":{\\\\\\\"Ordinal\\\\\\\":\\\\\\\"0\\\\\\\"}}]')\\\\r\\\\n|where CveId != 'cveID';\\\\r\\\\nCves\\\\r\\\\n| join kind=rightsemi (EasmAssetWebComponent\\\\r\\\\n    |where WorkspaceName == workspace\\\\r\\\\n    |where array_length(WebComponentCves) != 0\\\\r\\\\n    |where WebComponentLastSeen {_lastseen:query}\\\\r\\\\n    |mv-expand WebComponentCves\\\\r\\\\n    |extend Cve = tostring(WebComponentCves.Cve), Cwe = tostring(WebComponentCves.Cwe), CvssScore = tolong(WebComponentCves.CvssScore), Cvss3Score = toreal(WebComponentCves.Cvss3Score)\\\\r\\\\n    |where (CvssScore >= cvssscore or Cvss3Score >= cvss3score) \\\\r\\\\n    |project-keep WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName,WebComponentLastSeen\\\\r\\\\n    |summarize hint.strategy=shuffle arg_max(WebComponentLastSeen, *) by WebComponentCategory,WebComponentName,WebComponentVersion,Cve,Cwe,CvssScore,Cvss3Score,AssetName \\\\r\\\\n) on $left.CveId == $right.Cve\\\\r\\\\n//|project-reorder AssetName,WebComponentName,WebComponentVersion,Cve,CvssScore,Cvss3Score,Cwe\\\\r\\\\n//|sort by WebComponentLastSeen desc\\\\r\\\\n//|summarize Asset = make_list(pack_all()) by AssetName\\\\r\\\\n//|summarize CVE = make_list(pack_all()) by Cve\\\\r\\\\n|summarize WebComponent = make_list(pack_all()) by WebComponentName,WebComponentVersion\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"showAnalytics\":true,\"title\":\"CISA Known Exploited Vulnerabilities\",\"showRefreshButton\":true,\"exportFieldName\":\"\",\"exportParameterName\":\"_asset_detail\",\"showExportToExcel\":true,\"queryType\":9,\"gridSettings\":{\"rowLimit\":1000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"_group_by\",\"comparison\":\"isEqualTo\",\"value\":\"WebComponent\"},\"name\":\"CISA Known Exploited Vulnerabilities_groupBy WebComponent\",\"styleSettings\":{\"showBorder\":true}}]},\"conditionalVisibility\":{\"parameterName\":\"_workbook_source\",\"comparison\":\"isEqualTo\",\"value\":\"Azure Data Explorer\"},\"name\":\"ADX CVEs\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Host Details\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where AssetType == 'HOST'\\\\r\\\\n|summarize Count=count() by AssetType,SnapshotDateTime\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"aggregation\":5,\"showAnalytics\":true,\"title\":\"Hosts Over Time\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"timechart\"},\"name\":\"ADX Hosts Over Time\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"5f1dde0d-e3a4-4908-b7e1-05b9bcbf8844\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_sort_order\",\"label\":\"Sort Order\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[]},\"jsonData\":\"[\\\"asc\\\",\\\"desc\\\"]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"desc\"}],\"style\":\"formHorizontal\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"ADX Host Sorting\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmHostAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|extend Domain = iff(isnotempty(Domain), Domain, Host)\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(SnapshotDateTime, *) by Domain,AssetName\\\\r\\\\n|summarize Count=count() by Domain\\\\r\\\\n|sort by Count {_sort_order}\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":0,\"aggregation\":5,\"showAnalytics\":true,\"title\":\"Hosts by Domain\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Domain\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortOrderField\":1,\"size\":\"auto\"}},\"name\":\"ADX Hosts by Domain\"}]},\"conditionalVisibility\":{\"parameterName\":\"_workbook_source\",\"comparison\":\"isEqualTo\",\"value\":\"Azure Data Explorer\"},\"name\":\"ADX Host Details\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"IP Address Details\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where AssetType == 'IP_ADDRESS'\\\\r\\\\n|summarize Count=count() by AssetType,SnapshotDateTime\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"aggregation\":5,\"showAnalytics\":true,\"title\":\"IPs Over Time\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"timechart\"},\"name\":\"ADX IPs Over Time\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"5f1dde0d-e3a4-4908-b7e1-05b9bcbf8844\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_sort_order\",\"label\":\"Sort Order\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[]},\"jsonData\":\"[\\\"asc\\\",\\\"desc\\\"]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"desc\"}],\"style\":\"formHorizontal\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"ADX Host Sorting\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmIpAddressAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where array_length(IpBlocks) > 0\\\\r\\\\n|extend ReversedBlock = array_reverse(IpBlocks)\\\\r\\\\n|extend IpBlock = array_slice(ReversedBlock,0,0)\\\\r\\\\n|extend IpBlock = tostring(strcat_array(IpBlock,''))\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(SnapshotDateTime, *) by IpBlock,AssetName\\\\r\\\\n|summarize Count=count() by IpBlock\\\\r\\\\n|sort by Count {_sort_order}\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"aggregation\":5,\"showAnalytics\":true,\"title\":\"IPs by Block\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"IpBlock\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortOrderField\":1,\"size\":\"auto\"}},\"name\":\"ADX IPs by Block\"}]},\"conditionalVisibility\":{\"parameterName\":\"_workbook_source\",\"comparison\":\"isEqualTo\",\"value\":\"Azure Data Explorer\"},\"name\":\"ADX IP Addres Details\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Page Details\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where AssetType == 'PAGE'\\\\r\\\\n|summarize Count=count() by AssetType,SnapshotDateTime\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"aggregation\":5,\"showAnalytics\":true,\"title\":\"Pages Over Time\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"timechart\"},\"name\":\"ADX Pages Over Time\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"5f1dde0d-e3a4-4908-b7e1-05b9bcbf8844\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_sort_order\",\"label\":\"Sort Order\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[]},\"jsonData\":\"[\\\"asc\\\",\\\"desc\\\"]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"asc\"}],\"style\":\"formHorizontal\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"ADX Host Sorting\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmPageAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where isnotempty(SiteStatus)\\\\r\\\\n|summarize Count=count() by SiteStatus\\\\r\\\\n|sort by Count {_sort_order}\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":4,\"aggregation\":5,\"showAnalytics\":true,\"title\":\"Pages by Site Status\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"SiteStatus\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortOrderField\":1,\"size\":\"auto\"}},\"customWidth\":\"50\",\"name\":\"ADX Pages by Site Status\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmPageAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|extend ServicePort = todynamic(array_reverse(split(Service,':')))\\\\r\\\\n|mv-expand ServicePort limit 1\\\\r\\\\n|extend ServicePort = tostring(ServicePort)\\\\r\\\\n|extend Service = case(ServicePort == '443','HTTPS',ServicePort == '80','HTTP','OTHER')\\\\r\\\\n|summarize Count=count() by ServicePort,Service\\\\r\\\\n|sort by Count {_sort_order}\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":4,\"aggregation\":5,\"showAnalytics\":true,\"title\":\"Pages by Service\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Service\",\"formatter\":1},\"subtitleContent\":{\"columnMatch\":\"ServicePort\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortOrderField\":1,\"size\":\"auto\"}},\"customWidth\":\"50\",\"name\":\"ADX Pages by Service\"}]},\"conditionalVisibility\":{\"parameterName\":\"_workbook_source\",\"comparison\":\"isEqualTo\",\"value\":\"Azure Data Explorer\"},\"name\":\"ADX Page Details\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"SSL Certificate Details\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where AssetType == 'SSL_CERT'\\\\r\\\\n|summarize Count=count() by AssetType,SnapshotDateTime\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"aggregation\":5,\"showAnalytics\":true,\"title\":\"SSL Certificates Over Time\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"timechart\"},\"name\":\"ADX SSL Certificates Over Time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\n//let lastseen = ago(totimespan(_lastseen));\\\\r\\\\nEasmRisk\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where MetricDisplayName contains \\\\\\\"certificates\\\\\\\"\\\\r\\\\n|extend ReversedAuditTrail = array_reverse(AssetDiscoveryAuditTrail)\\\\r\\\\n|project-away AssetDiscoveryAuditTrail, AssetLastSeen\\\\r\\\\n|mv-expand ReversedAuditTrail limit 1\\\\r\\\\n|join kind=inner (EasmSslCertAsset\\\\r\\\\n    | where WorkspaceName == workspace\\\\r\\\\n    | where AssetLastSeen {_lastseen:query}\\\\r\\\\n    | where (AssetLastSeen > InvalidAfter or (InvalidAfter > now() and InvalidAfter-30d < now()))\\\\r\\\\n    | extend Status = iff((AssetLastSeen > InvalidAfter),'Expired','Expiring in 30 days')\\\\r\\\\n    | extend CertCommonName = strcat_array(SubjectCommonNames,'')\\\\r\\\\n    | extend CertSha1 = AssetName\\\\r\\\\n    | project-keep AssetUuid, AssetLastSeen, CertCommonName, CertSha1, InvalidAfter,Status\\\\r\\\\n    ) on AssetUuid\\\\r\\\\n|project-keep ReversedAuditTrail,AssetLastSeen,CertCommonName,CertSha1,InvalidAfter,Status\\\\r\\\\n|extend AssetName = tostring(ReversedAuditTrail.AssetType)\\\\r\\\\n|project-away ReversedAuditTrail\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(AssetLastSeen, *) by AssetName,CertCommonName,CertSha1,InvalidAfter,Status\\\\r\\\\n|order by InvalidAfter asc\\\\r\\\\n|project-reorder AssetName,Status,InvalidAfter,AssetLastSeen\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"showAnalytics\":true,\"title\":\" SSL Certs Expired or Expiring Soon\",\"noDataMessage\":\"No expired or soon-to-expire certificates found\",\"showRefreshButton\":true,\"exportParameterName\":\"_asset_detail\",\"showExportToExcel\":true,\"queryType\":9,\"gridSettings\":{\"rowLimit\":1000,\"filter\":true}},\"customWidth\":\"50\",\"name\":\" ADX SSL Certs Expired or Expiring Soon\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmSslCertAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where AssetLastSeen {_lastseen:query}\\\\r\\\\n|where IsSelfSigned == true\\\\r\\\\n|mv-expand SubjectCommonNames\\\\r\\\\n|extend CommonName = tostring(SubjectCommonNames)\\\\r\\\\n|join (EasmHostAsset\\\\r\\\\n    |where WorkspaceName == workspace\\\\r\\\\n    |where AssetLastSeen {_lastseen:query}\\\\r\\\\n    |mv-expand SslCerts\\\\r\\\\n    |extend HostThumb = tostring(SslCerts)\\\\r\\\\n    |extend SeenOnHost = Host\\\\r\\\\n    |summarize hint.strategy=shuffle arg_max(SnapshotDateTime, *) by SeenOnHost,HostThumb\\\\r\\\\n    |project-keep SeenOnHost,HostThumb\\\\r\\\\n) on $left.Thumbprint == $right.HostThumb\\\\r\\\\n|join (EasmIpAddressAsset\\\\r\\\\n    |where WorkspaceName == workspace\\\\r\\\\n    |where AssetLastSeen {_lastseen:query}\\\\r\\\\n    |mv-expand SslCerts\\\\r\\\\n    |extend IpThumb = tostring(SslCerts)\\\\r\\\\n    |extend SeenOnIp = IpAddress\\\\r\\\\n    |summarize hint.strategy=shuffle arg_max(SnapshotDateTime, *) by SeenOnIp,IpThumb\\\\r\\\\n    |project-keep SeenOnIp,IpThumb\\\\r\\\\n) on $left.Thumbprint == $right.IpThumb\\\\r\\\\n|summarize hint.strategy=shuffle arg_max(SnapshotDateTime, *) by CommonName,SeenOnHost,SeenOnIp\\\\r\\\\n|extend Sha1 = Thumbprint\\\\r\\\\n|project-keep CommonName,SeenOnHost,SeenOnIp,Sha1\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"aggregation\":2,\"showAnalytics\":true,\"title\":\"Self-Signed Certificates\",\"noDataMessage\":\"No self-signed certificates found\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Group\",\"formatter\":1}],\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"CommonName\"],\"expandTopLevel\":false}},\"graphSettings\":{\"type\":2,\"topContent\":{\"columnMatch\":\"SeenOnHost\"},\"centerContent\":{\"columnMatch\":\"CommonName\"},\"bottomContent\":{\"columnMatch\":\"SeenOnIp\"},\"hivesContent\":{\"columnMatch\":\"CommonName\",\"formatter\":1},\"nodeIdField\":\"CommonName\",\"sourceIdField\":\"SeenOnHost\",\"targetIdField\":\"SeenOnIp\",\"graphOrientation\":3,\"showOrientationToggles\":false,\"nodeSize\":null,\"staticNodeSize\":100,\"colorSettings\":{\"nodeColorField\":\"SeenOnIp\",\"type\":1,\"colorPalette\":\"default\"},\"groupByField\":\"CommonName\",\"hivesMargin\":5}},\"customWidth\":\"50\",\"name\":\"ADX Self-Signed Certificates\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmSslCertAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|mv-expand IssuerOrganizations\\\\r\\\\n|where isnotempty(IssuerOrganizations)\\\\r\\\\n|extend Org = tostring(IssuerOrganizations)\\\\r\\\\n|summarize Count=count() by Org\\\\r\\\\n|sort by Count asc\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":0,\"aggregation\":2,\"showAnalytics\":true,\"title\":\"Certificate Issuer Orgs\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"categoricalbar\"},\"customWidth\":\"50\",\"name\":\"ADX Certificate Issuer Orgs\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmSslCertAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|mv-expand SubjectOrganizations\\\\r\\\\n|where isnotempty(SubjectOrganizations)\\\\r\\\\n|extend Org = tostring(SubjectOrganizations)\\\\r\\\\n|summarize Count=count() by Org\\\\r\\\\n|sort by Count asc\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":0,\"aggregation\":2,\"showAnalytics\":true,\"title\":\"Certificate Subject Orgs\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"categoricalbar\"},\"customWidth\":\"50\",\"name\":\"ADX Certificate Subject Orgs\",\"styleSettings\":{\"showBorder\":true}}]},\"conditionalVisibility\":{\"parameterName\":\"_workbook_source\",\"comparison\":\"isEqualTo\",\"value\":\"Azure Data Explorer\"},\"name\":\"ADX SSL Certificate Details\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Domain Details\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|where AssetType == 'DOMAIN'\\\\r\\\\n|summarize Count=count() by AssetType,SnapshotDateTime\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":1,\"aggregation\":5,\"showAnalytics\":true,\"title\":\"Domains Over Time\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"timechart\",\"chartSettings\":{\"group\":null,\"createOtherGroup\":0}},\"name\":\"ADX Domains Over Time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmDomainAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|mv-expand AdminOrgs \\\\r\\\\n|where isnotempty(AdminOrgs)\\\\r\\\\n|extend Org = tostring(AdminOrgs)\\\\r\\\\n|summarize Count=count() by Org\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":3,\"showAnalytics\":true,\"title\":\"Admin Orgs\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"AdminOrgs\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"AdminOrgs\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"AdminOrgs\",\"sourceIdField\":\"AdminOrgs\",\"targetIdField\":\"AdminOrgs\",\"graphOrientation\":1,\"showOrientationToggles\":false,\"nodeSize\":null,\"staticNodeSize\":100,\"colorSettings\":null,\"groupByField\":\"AdminOrgs\",\"hivesMargin\":5},\"chartSettings\":{\"group\":\"Org\",\"createOtherGroup\":8},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"Count\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"Count\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"Count\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"33\",\"name\":\"ADX Admin Orgs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmDomainAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|mv-expand RegistrantOrgs \\\\r\\\\n|where isnotempty(RegistrantOrgs)\\\\r\\\\n|extend Org = tostring(RegistrantOrgs)\\\\r\\\\n|summarize Count=count() by Org\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":3,\"showAnalytics\":true,\"title\":\"Registrant Orgs\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"AdminOrgs\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"AdminOrgs\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"AdminOrgs\",\"sourceIdField\":\"AdminOrgs\",\"targetIdField\":\"AdminOrgs\",\"graphOrientation\":1,\"showOrientationToggles\":false,\"nodeSize\":null,\"staticNodeSize\":100,\"colorSettings\":null,\"groupByField\":\"AdminOrgs\",\"hivesMargin\":5},\"chartSettings\":{\"group\":\"Org\",\"createOtherGroup\":8},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"Count\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"Count\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"Count\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"33\",\"name\":\"ADX Registrant Orgs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmDomainAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|mv-expand TechnicalOrgs \\\\r\\\\n|where isnotempty(TechnicalOrgs)\\\\r\\\\n|extend Org = tostring(TechnicalOrgs)\\\\r\\\\n|summarize Count=count() by Org\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":3,\"showAnalytics\":true,\"title\":\"Technical Orgs\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"AdminOrgs\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"AdminOrgs\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"AdminOrgs\",\"sourceIdField\":\"AdminOrgs\",\"targetIdField\":\"AdminOrgs\",\"graphOrientation\":1,\"showOrientationToggles\":false,\"nodeSize\":null,\"staticNodeSize\":100,\"colorSettings\":null,\"groupByField\":\"AdminOrgs\",\"hivesMargin\":5},\"chartSettings\":{\"group\":\"Org\",\"createOtherGroup\":8},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"Count\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"Count\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"Count\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"33\",\"name\":\"ADX Technical Orgs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmDomainAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|mv-expand AdminContacts \\\\r\\\\n|where isnotempty(AdminContacts)\\\\r\\\\n|extend Contact = tostring(AdminContacts)\\\\r\\\\n|summarize Count=count() by Contact\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":3,\"showAnalytics\":true,\"title\":\"Admin Contacts\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"AdminOrgs\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"AdminOrgs\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"AdminOrgs\",\"sourceIdField\":\"AdminOrgs\",\"targetIdField\":\"AdminOrgs\",\"graphOrientation\":1,\"showOrientationToggles\":false,\"nodeSize\":null,\"staticNodeSize\":100,\"colorSettings\":null,\"groupByField\":\"AdminOrgs\",\"hivesMargin\":5},\"chartSettings\":{\"group\":\"Contact\",\"createOtherGroup\":8},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"Count\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"Count\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"Count\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"33\",\"name\":\"ADX Admin Contacts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmDomainAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|mv-expand AdminContacts \\\\r\\\\n|where isnotempty(AdminContacts)\\\\r\\\\n|extend Contact = tostring(AdminContacts)\\\\r\\\\n|summarize Count=count() by Contact\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":3,\"showAnalytics\":true,\"title\":\"Registrant Contacts\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"AdminOrgs\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"AdminOrgs\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"AdminOrgs\",\"sourceIdField\":\"AdminOrgs\",\"targetIdField\":\"AdminOrgs\",\"graphOrientation\":1,\"showOrientationToggles\":false,\"nodeSize\":null,\"staticNodeSize\":100,\"colorSettings\":null,\"groupByField\":\"AdminOrgs\",\"hivesMargin\":5},\"chartSettings\":{\"group\":\"Contact\",\"createOtherGroup\":8},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"Count\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"Count\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"Count\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"33\",\"name\":\"ADX Registrant Contacts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"AzureDataExplorerQuery/1.0\\\",\\\"queryText\\\":\\\"let workspace = '{_workspace_name}';\\\\r\\\\nEasmDomainAsset\\\\r\\\\n|where WorkspaceName == workspace\\\\r\\\\n|mv-expand TechnicalContacts \\\\r\\\\n|where isnotempty(TechnicalContacts)\\\\r\\\\n|extend Contact = tostring(TechnicalContacts)\\\\r\\\\n|summarize Count=count() by Contact\\\",\\\"clusterName\\\":\\\"{_adx_cluster_uri}\\\",\\\"databaseName\\\":\\\"{_adx_database_name}\\\"}\",\"size\":3,\"showAnalytics\":true,\"title\":\"Technical Contacts\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":9,\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"AdminOrgs\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"AdminOrgs\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"AdminOrgs\",\"sourceIdField\":\"AdminOrgs\",\"targetIdField\":\"AdminOrgs\",\"graphOrientation\":1,\"showOrientationToggles\":false,\"nodeSize\":null,\"staticNodeSize\":100,\"colorSettings\":null,\"groupByField\":\"AdminOrgs\",\"hivesMargin\":5},\"chartSettings\":{\"group\":\"Contact\",\"createOtherGroup\":8},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"Count\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"Count\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"Count\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"33\",\"name\":\"ADX Technical Contacts\"}]},\"conditionalVisibility\":{\"parameterName\":\"_workbook_source\",\"comparison\":\"isEqualTo\",\"value\":\"Azure Data Explorer\"},\"name\":\"ADX Domain Details\",\"styleSettings\":{\"showBorder\":true}}],\"isLocked\":false,\"defaultResourceIds\":[\"[variables('workbookSourceId')]\",\"/subscriptions/41db8a20-7583-407e-a736-58551e919dcc/resourceGroups/ADX/providers/Microsoft.Kusto/clusters/fdpoeasmadx\"],\"fallbackResourceIds\":[\"[variables('workbookSourceId')]\",\"/subscriptions/41db8a20-7583-407e-a736-58551e919dcc/resourceGroups/ADX/providers/Microsoft.Kusto/clusters/fdpoeasmadx\"],\"fromTemplateId\":\"sentinel-UserWorkbook\"}",
        "version": "1.0",
        "sourceId": "[variables('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"
}